(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{12:function(e,t,n){e.exports=n(22)},17:function(e,t,n){},18:function(e,t,n){},22:function(e,t,n){"use strict";n.r(t);var o,r=n(2),a=n.n(r),i=n(11),l=n.n(i),c=(n(17),n(3)),s=n(1),u=n(4),y=n(5),d=n(7),m=n(6),p=n(8),f=(n(18),n(0)),h=n.n(f);!function(e){e.Floor="&nbsp;",e.Wall="\u2588",e.Player="<span style='background-color: #aaa'>@</span>",e.Door="#",e.Enemy="<span style='color: red'>k</span>",e.EnemyTired="<span style='color: darkred'>k</span>",e.ItemSword="<span style='color: red'>\u2020</span>",e.ItemMoney="<span style='color: green'>$</span>",e.ItemNormal="<span style='color: lightblue'>!</span>",e.ItemPush="<span style='color: yellow'>O</span>",e.ItemBlock="<span style='color: saddlebrown'>+</span>",e.HeldItemSword="<span style='color: red; background-color: #aaa'>\u2020</span>",e.HeldItemMoney="<span style='color: green; background-color: #aaa'>$</span>",e.HeldItemNormal="<span style='color: lightblue; background-color: #aaa'>!</span>",e.HeldItemPush="<span style='color: yellow; background-color: #aaa'>O</span>",e.HeldItemBlock="<span style='color: saddlebrown; background-color: #aaa''>+</span>",e.PlayerItem="$",e.Item="!",e.VerticalWall="\u2502",e.HorizontalWall="\u2500",e.TopLeftCorner="\u250c",e.TopRightCorner="\u2510",e.BottomLeftCorner="\u2514",e.BottomRightCorner="\u2518"}(o||(o={}));var v=function(e){var t=e.currentRoom,n=t.size,r=t.enemies,a=t.tiredEnemies,i=t.exits,l=t.walls,c=e.player,s=[];function u(e,t,o){e<-1||e>n||t<-1||t>n||(s[n-t][e+1]=o)}for(var y=0;y<=n+1;y++){s[y]=[];for(var d=0;d<=n+1;d++)s[y][d]=o.Floor}for(var m=-1;m<=n;m++)u(m,-1,o.HorizontalWall),u(m,n,o.HorizontalWall),u(-1,m,o.VerticalWall),u(n,m,o.VerticalWall);return u(-1,-1,o.BottomLeftCorner),u(n,-1,o.BottomRightCorner),u(-1,n,o.TopLeftCorner),u(n,n,o.TopRightCorner),l.forEach(function(e){u(e.x,e.y,o.Wall)}),i.forEach(function(e){u(e.x,e.y,o.Door)}),e.currentRoom.items.forEach(function(e){u(e.x,e.y,e.type)}),e.player.items.forEach(function(t){u(t.x+e.player.x,t.y+e.player.y,t.heldType)}),u(c.x,c.y,o.Player),a.forEach(function(e){u(e.x,e.y,o.EnemyTired)}),r.forEach(function(e){u(e.x,e.y,o.Enemy)}),s};var x=n(20),w=x.astar,g=x.Graph;function b(e){return S(Object(s.a)({},e.player,{x:e.player.x-1}),e)}function k(e){return S(Object(s.a)({},e.player,{x:e.player.x+1}),e)}function E(e){return S(Object(s.a)({},e.player,{y:e.player.y+1}),e)}function I(e){return S(Object(s.a)({},e.player,{y:e.player.y-1}),e)}function R(e){return S(e.player,e)}function j(e){var t=Object(c.a)(e.currentRoom.items),n=e.player.items;return e.player.items.forEach(function(o){var r,a,i=(r=e.player,a=o,Object(s.a)({},a,{x:a.x+r.x,y:a.y+r.y}));t.push(i),n=h.a.without(n,o)}),t.length>0?Object(s.a)({},e,{player:Object(s.a)({},e.player,{items:n}),currentRoom:Object(s.a)({},e.currentRoom,{items:t})}):e}function S(e,t){var n=function(e,t){var n,r=e.player,a=h.a.cloneDeep(e.currentRoom.enemies),i=[],l=[],c=[],u=!1,y=h.a.find(e.currentRoom.items,function(e){return e.x===r.x&&e.y===r.y});y&&(i.push(y),l.push(O(t.player,y)),u=!0);h.a.find(e.currentRoom.enemies,function(e){return e.x===r.x&&e.y===r.y})&&(u=!0);r.items.forEach(function(n){var s=h.a.find(e.currentRoom.items,function(e){return e.x===n.x+r.x&&e.y===n.y+r.y});if(s&&(u=!0,i.push(s),l.push(O(t.player,s))),n.type===o.ItemSword){var y=h.a.find(a,function(e){return e.x===n.x+r.x&&e.y===n.y+r.y});y&&(c.push(n),a=h.a.without(a,y),u=!0)}}),u&&(r.x=t.player.x,r.y=t.player.y);var d=h.a.without.apply(h.a,[e.currentRoom.items].concat(i));return(n=r.items).push.apply(n,l),r.items=h.a.without.apply(h.a,[r.items].concat(c)),Object(s.a)({},e,{player:r,currentRoom:Object(s.a)({},e.currentRoom,{enemies:a,items:d})})}(Object(s.a)({},t,{player:e}),t);return function(e){var t=e.player.items.map(function(t){return{x:t.x+e.player.x,y:t.y+e.player.y}});if(t.push({x:e.player.x,y:e.player.y}),h.a.intersectionWith(t,e.currentRoom.walls,h.a.isEqual).length>0)return!1;var n=function(e){for(var t=[],n=-1;n<=e.currentRoom.size;n++)t.push({x:-1,y:n}),t.push({x:e.currentRoom.size,y:n}),t.push({x:n,y:-1}),t.push({x:n,y:e.currentRoom.size});return h.a.differenceWith(t,e.currentRoom.exits,h.a.isEqual)}(e);if(h.a.intersectionWith(t,n,h.a.isEqual).length>0)return!1;var r=e.player.items.filter(function(e){return e.type===o.ItemBlock}).map(function(t){return{x:t.x+e.player.x,y:t.y+e.player.y}}),a=!0,i=!1,l=void 0;try{for(var c,s=function(){var t=c.value,n=e.currentRoom.items.find(function(e){return e.x===t.x&&e.y===t.y});if(n)return{v:!1}},u=r[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var y=s();if("object"===typeof y)return y.v}}catch(d){i=!0,l=d}finally{try{a||null==u.return||u.return()}finally{if(i)throw l}}return!0}(n)?(function(e){var t=h.a.flatten(v(e));return!h.a.find(t,function(e){return e===o.Player||e===o.PlayerItem})}(n)&&(n.exited=!0),n=function(e){var t=h.a.cloneDeep(e),n=[o.Floor,o.Player,o.HeldItemBlock,o.HeldItemMoney,o.HeldItemNormal,o.HeldItemPush,o.HeldItemSword],r=!0,a=!1,i=void 0;try{for(var l,c=function(){var r=l.value,a=t.player.items.find(function(e){return e.x+t.player.x===r.x&&e.y+t.player.y===r.y});if(a)return t.currentRoom.enemies=h.a.without(t.currentRoom.enemies,r),t.currentRoom.tiredEnemies.push(r),t.player.items=h.a.without(t.player.items,a),"continue";for(var i=[[]],c=v(t),s=0;s<c.length-2;s++){i.push([]);for(var u=0;u<c[s].length-2;u++)h.a.includes(n,c[s+1][u+1])?i[s][u]=1:i[s][u]=0}(i=i.reverse()).shift(),console.log("%cPathfinding Grid","font-weight: bold"),console.log("%c".concat(i.map(function(e,t){return"".concat(t,": ").concat(e.join(""))}).join("\n")),"font-family: monospace");var y=new g(i);console.log("(".concat(e.player.x,", ").concat(e.player.y,")"),"(".concat(r.x,", ").concat(r.y,")"));var d=w.search(y,y.grid[r.y][r.x],y.grid[e.player.y][e.player.x],{heuristic:w.heuristics.manhattan});if(console.log(d.map(function(e){return"(".concat(e.x,", ").concat(e.y,")")}).join(" ")),d.length>0){var m={x:d[0].y,y:d[0].x},p={x:r.x,y:r.y};r.x=m.x,r.y=m.y,console.log(m),e.player.x===r.x&&e.player.y===r.y&&(t.hp-=1,r.x=p.x,r.y=p.y,t.hp<=0&&(t.gameOver=!0));var f=t.player.items.find(function(e){return t.player.x+e.x===r.x&&t.player.y+e.y===r.y});f&&(r.x=p.x,r.y=p.y,f.type!==o.ItemSword&&(t.currentRoom.enemies=h.a.without(t.currentRoom.enemies,r),t.currentRoom.tiredEnemies.push(r),t.player.items=h.a.without(t.player.items,f)))}},s=t.currentRoom.enemies[Symbol.iterator]();!(r=(l=s.next()).done);r=!0)c()}catch(x){a=!0,i=x}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}var u=!0,y=!1,d=void 0;try{for(var m,p=e.currentRoom.tiredEnemies[Symbol.iterator]();!(u=(m=p.next()).done);u=!0){var f=m.value;t.currentRoom.tiredEnemies=h.a.without(t.currentRoom.enemies,f),t.currentRoom.enemies.push(f)}}catch(x){y=!0,d=x}finally{try{u||null==p.return||p.return()}finally{if(y)throw d}}return console.log(t),t}(n)):(console.log("Wall?"),t)}function O(e,t){return Object(s.a)({},t,{x:t.x-e.x,y:t.y-e.y})}function T(e){for(var t=[],n=0;n<8;n++)for(var r=0;r<8;r++)t.push({x:r,y:n});t=h.a.shuffle(t);for(var a=h.a.random(3,8),i=[],l=0;l<a;l++){var s=t.shift();i.push(H(s))}for(var u=[],y=h.a.filter(i,function(e){return e.type===o.ItemSword}).length,d=0;d<y;d++){var m=t.shift();u.push(m)}for(var p=Object(c.a)(e),f=h.a.shuffle([{x:-1,y:1/0},{x:8,y:1/0},{x:1/0,y:-1},{x:1/0,y:8}]),v=h.a.random(1,3),x=0;x<v;x++)for(var w=f.shift(),g=h.a.sample([1,2,2,2,3,3,4]),b=h.a.random(0,7-g),k=0;k<g;k++){var E={x:w.x,y:w.y};E.x===1/0?E.x=b+k:E.y===1/0&&(E.y=b+k),p.push(E)}return{size:8,exits:p,items:i,enemies:u,tiredEnemies:[],walls:[]}}function H(e){var t=[[o.ItemSword,o.HeldItemSword],[o.ItemMoney,o.HeldItemMoney],[o.ItemNormal,o.HeldItemNormal],[o.ItemPush,o.HeldItemPush],[o.ItemBlock,o.HeldItemBlock]],n=h.a.sample(t);return Object(s.a)({},e,{type:n[0],heldType:n[1]})}var B=function(e){function t(){var e,n;Object(u.a)(this,t);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return(n=Object(d.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).handleClick=function(){n.props.onClick(n.props.type)},n}return Object(p.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return r.createElement("div",{className:this.props.selected?"selected":"","data-tiletype":this.props.type,key:this.props.type,dangerouslySetInnerHTML:{__html:this.props.type},onTouchStart:this.handleClick})}}]),t}(r.Component),C=n(21),D=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(m.a)(t).call(this,e))).joystickTimerId=void 0,n.maybeTouch=!1,n.initialState=void 0,n.undoStack=[],n.perform=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.state,o=e(t);return h.a.isEqual(o,t)||n.undoStack.push(e),o.gameOver?(console.log(o,n.initialState),h.a.cloneDeep(n.initialState)):o},n.handleJoystickMove=function(e){n.joystickTimerId&&clearTimeout(n.joystickTimerId),console.log(e.target.direction.angle);var t={up:E,down:I,left:b,right:k}[e.target.direction.angle];if(t){n.joystickTimerId=setTimeout(function e(){n.setState(n.perform(t)),n.joystickTimerId=setTimeout(e,150)},300),n.setState(n.perform(t))}else console.log("COULD NOT FIND HANDLER",e)},n.handleJoystickEnd=function(e){n.joystickTimerId&&clearTimeout(n.joystickTimerId)},n.handleKeyDown=function(e){var t={ArrowUp:E,ArrowDown:I,ArrowLeft:b,ArrowRight:k,Space:j,Period:R};if("KeyU"!==e.code&&"KeyZ"!==e.code){var o=t[e.code];o?n.setState(n.perform(o)):console.log("COULD NOT FIND HANDLER",e)}else{var r=h.a.cloneDeep(n.initialState);n.undoStack.pop();var a=!0,i=!1,l=void 0;try{for(var c,s=n.undoStack[Symbol.iterator]();!(a=(c=s.next()).done);a=!0){r=(0,c.value)(r)}}catch(u){i=!0,l=u}finally{try{a||null==s.return||s.return()}finally{if(i)throw l}}n.setState(r)}},n.didTapDrop=function(){n.setState(n.perform(j))},n.handleTouchStart=function(e){n.maybeTouch=!0},n.handleTouchMove=function(e){n.maybeTouch=!1},n.handleTouchEnd=function(e){n.maybeTouch&&n.didTapDrop(),n.maybeTouch=!1},n.handleEditorButtonClick=function(e){n.setState({selectedEditorButton:e})},n.handleEditorBoardClick=function(e,t){var r=n.state.selectedEditorButton;if(r)if(r===o.Player)n.setState({selectedEditorButton:void 0,player:Object(s.a)({},n.state.player,{x:e,y:t})});else if(r===o.Enemy){var a=[].concat(Object(c.a)(n.state.currentRoom.enemies),[{x:e,y:t,type:r}]);n.setState({selectedEditorButton:void 0,currentRoom:Object(s.a)({},n.state.currentRoom,{enemies:a})})}else if(r===o.Door){var i=[].concat(Object(c.a)(n.state.currentRoom.exits),[{x:e,y:t}]);n.setState({selectedEditorButton:void 0,currentRoom:Object(s.a)({},n.state.currentRoom,{exits:i})})}else if(r===o.Wall){var l=[].concat(Object(c.a)(n.state.currentRoom.walls),[{x:e,y:t}]);n.setState({selectedEditorButton:void 0,currentRoom:Object(s.a)({},n.state.currentRoom,{walls:l})})}else{var u={x:e,y:t,type:r,heldType:function(e){return e===o.ItemBlock?o.HeldItemBlock:e===o.ItemNormal?o.HeldItemNormal:e===o.ItemMoney?o.HeldItemMoney:e===o.ItemSword?o.HeldItemSword:e===o.ItemPush?o.HeldItemPush:e}(r)},y=[].concat(Object(c.a)(n.state.currentRoom.items),[u]);n.setState({selectedEditorButton:void 0,currentRoom:Object(s.a)({},n.state.currentRoom,{items:y})})}},n.initialState={exited:!1,gameOver:!1,hp:3,maxHP:3,player:{x:2,y:2,items:[]},currentRoom:T([{x:-1,y:4}])},n.state=h.a.cloneDeep(n.initialState),n}return Object(p.a)(t,e),Object(y.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("touchstart",this.handleTouchStart),window.addEventListener("touchmove",this.handleTouchMove),window.addEventListener("touchend",this.handleTouchEnd),C.create({color:"#000",dataOnly:!0,fadeTime:0}).on("added",function(t,n){n.on("dir",e.handleJoystickMove),n.on("end",e.handleJoystickEnd)})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var e=this,t=function(e){var t=e.tiles.map(function(t,n){var o=t.map(function(t,o){return a.a.createElement("span",{"data-x":o-1,"data-y":e.size-n,dangerouslySetInnerHTML:{__html:t},onTouchStart:function(){return e.onClick(o-1,e.size-n)}})});return a.a.createElement("div",null,o)});return a.a.createElement("div",{id:"grid"},t)}({tiles:v(this.state),size:this.state.currentRoom.size,onClick:this.handleEditorBoardClick}),n=this.state.player.items.filter(function(e){return e.type===o.ItemMoney}).length,r=[o.Player,o.Enemy,o.ItemBlock,o.ItemMoney,o.ItemNormal,o.ItemSword,o.Wall,o.Door].map(function(t){return a.a.createElement(B,{type:t,onClick:e.handleEditorButtonClick,selected:e.state.selectedEditorButton===t})});return a.a.createElement("div",{className:"App"},a.a.createElement("div",{id:"score-and-hp"},"$",n," | ",this.state.hp,"/",this.state.maxHP),t,a.a.createElement("div",{id:"level-editor"},r))}}]),t}(a.a.Component),W=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function P(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}l.a.render(a.a.createElement(D,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/encumbered",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/encumbered","/service-worker.js");W?(function(e,t){fetch(e).then(function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):P(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):P(t,e)})}}()}},[[12,1,2]]]);
//# sourceMappingURL=main.f6e9fe91.chunk.js.map