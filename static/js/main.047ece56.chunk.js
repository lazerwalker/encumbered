(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{12:function(e,t,r){e.exports=r(22)},17:function(e,t,r){},18:function(e,t,r){},22:function(e,t,r){"use strict";r.r(t);var o,n=r(2),a=r.n(n),i=r(11),l=r.n(i),c=(r(17),r(3)),s=r(1),u=r(4),y=r(5),m=r(7),d=r(6),p=r(8),f=(r(18),r(0)),h=r.n(f);!function(e){e.Floor="&nbsp;",e.Wall="\u2588",e.Player="<span style='background-color: #aaa'>@</span>",e.Door="#",e.Enemy="<span style='color: red'>k</span>",e.EnemyTired="<span style='color: darkred'>k</span>",e.ItemSword="<span style='color: red'>\u2020</span>",e.ItemMoney="<span style='color: green'>$</span>",e.ItemNormal="<span style='color: lightblue'>!</span>",e.ItemPush="<span style='color: yellow'>O</span>",e.ItemBlock="<span style='color: saddlebrown'>+</span>",e.HeldItemSword="<span style='color: red; background-color: #aaa'>\u2020</span>",e.HeldItemMoney="<span style='color: green; background-color: #aaa'>$</span>",e.HeldItemNormal="<span style='color: lightblue; background-color: #aaa'>!</span>",e.HeldItemPush="<span style='color: yellow; background-color: #aaa'>O</span>",e.HeldItemBlock="<span style='color: saddlebrown; background-color: #aaa''>+</span>",e.PlayerItem="$",e.Item="!",e.VerticalWall="\u2502",e.HorizontalWall="\u2500",e.TopLeftCorner="\u250c",e.TopRightCorner="\u2510",e.BottomLeftCorner="\u2514",e.BottomRightCorner="\u2518"}(o||(o={}));var v=function(e){var t=e.currentRoom,r=t.size,n=t.enemies,a=t.tiredEnemies,i=t.exits,l=t.walls,c=e.player,s=[];function u(e,t,o){e<-1||e>r||t<-1||t>r||(s[r-t][e+1]=o)}for(var y=0;y<=r+1;y++){s[y]=[];for(var m=0;m<=r+1;m++)s[y][m]=o.Floor}for(var d=-1;d<=r;d++)u(d,-1,o.HorizontalWall),u(d,r,o.HorizontalWall),u(-1,d,o.VerticalWall),u(r,d,o.VerticalWall);return u(-1,-1,o.BottomLeftCorner),u(r,-1,o.BottomRightCorner),u(-1,r,o.TopLeftCorner),u(r,r,o.TopRightCorner),l.forEach(function(e){u(e.x,e.y,o.Wall)}),i.forEach(function(e){u(e.x,e.y,o.Door)}),e.currentRoom.items.forEach(function(e){u(e.x,e.y,e.type)}),e.player.items.forEach(function(t){u(t.x+e.player.x,t.y+e.player.y,t.heldType)}),u(c.x,c.y,o.Player),a.forEach(function(e){u(e.x,e.y,o.EnemyTired)}),n.forEach(function(e){u(e.x,e.y,o.Enemy)}),s};var x=r(20),w=x.astar,I=x.Graph;function b(e){return O(Object(s.a)({},e.player,{x:e.player.x-1}),e)}function E(e){return O(Object(s.a)({},e.player,{x:e.player.x+1}),e)}function g(e){return O(Object(s.a)({},e.player,{y:e.player.y+1}),e)}function k(e){return O(Object(s.a)({},e.player,{y:e.player.y-1}),e)}function R(e){return O(e.player,e)}function j(e){var t=Object(c.a)(e.currentRoom.items),r=e.player.items;return e.player.items.forEach(function(o){var n,a,i=(n=e.player,a=o,Object(s.a)({},a,{x:a.x+n.x,y:a.y+n.y}));t.push(i),r=h.a.without(r,o)}),t.length>0?Object(s.a)({},e,{player:Object(s.a)({},e.player,{items:r}),currentRoom:Object(s.a)({},e.currentRoom,{items:t})}):e}function O(e,t){var r=function(e,t){var r,n=e.player,a=h.a.cloneDeep(e.currentRoom.enemies),i=[],l=[],c=[],u=!1,y=h.a.find(e.currentRoom.items,function(e){return e.x===n.x&&e.y===n.y});y&&(i.push(y),l.push(S(t.player,y)),u=!0);h.a.find(e.currentRoom.enemies,function(e){return e.x===n.x&&e.y===n.y})&&(u=!0);n.items.forEach(function(r){var s=h.a.find(e.currentRoom.items,function(e){return e.x===r.x+n.x&&e.y===r.y+n.y});if(s&&(u=!0,i.push(s),l.push(S(t.player,s))),r.type===o.ItemSword){var y=h.a.find(a,function(e){return e.x===r.x+n.x&&e.y===r.y+n.y});y&&(c.push(r),a=h.a.without(a,y),u=!0)}}),u&&(n.x=t.player.x,n.y=t.player.y);var m=h.a.without.apply(h.a,[e.currentRoom.items].concat(i));return(r=n.items).push.apply(r,l),n.items=h.a.without.apply(h.a,[n.items].concat(c)),Object(s.a)({},e,{player:n,currentRoom:Object(s.a)({},e.currentRoom,{enemies:a,items:m})})}(Object(s.a)({},t,{player:e}),t);return function(e){var t=e.player.items.map(function(t){return{x:t.x+e.player.x,y:t.y+e.player.y}});if(t.push({x:e.player.x,y:e.player.y}),h.a.intersectionWith(t,e.currentRoom.walls,h.a.isEqual).length>0)return!1;var r=function(e){for(var t=[],r=-1;r<=e.currentRoom.size;r++)t.push({x:-1,y:r}),t.push({x:e.currentRoom.size,y:r}),t.push({x:r,y:-1}),t.push({x:r,y:e.currentRoom.size});return h.a.differenceWith(t,e.currentRoom.exits,h.a.isEqual)}(e);if(h.a.intersectionWith(t,r,h.a.isEqual).length>0)return!1;var n=e.player.items.filter(function(e){return e.type===o.ItemBlock}).map(function(t){return{x:t.x+e.player.x,y:t.y+e.player.y}}),a=!0,i=!1,l=void 0;try{for(var c,s=function(){var t=c.value,r=e.currentRoom.items.find(function(e){return e.x===t.x&&e.y===t.y});if(r)return{v:!1}},u=n[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var y=s();if("object"===typeof y)return y.v}}catch(m){i=!0,l=m}finally{try{a||null==u.return||u.return()}finally{if(i)throw l}}return!0}(r)?(function(e){var t=h.a.flatten(v(e));return!h.a.find(t,function(e){return e===o.Player||e===o.PlayerItem})}(r)&&(r.exited=!0),r=function(e){var t=h.a.cloneDeep(e),r=[o.Floor,o.Player,o.HeldItemBlock,o.HeldItemMoney,o.HeldItemNormal,o.HeldItemPush,o.HeldItemSword],n=!0,a=!1,i=void 0;try{for(var l,c=function(){var n=l.value,a=t.player.items.find(function(e){return e.x+t.player.x===n.x&&e.y+t.player.y===n.y});if(a)return t.currentRoom.enemies=h.a.without(t.currentRoom.enemies,n),t.currentRoom.tiredEnemies.push(n),t.player.items=h.a.without(t.player.items,a),"continue";for(var i=[[]],c=v(t),s=0;s<c.length-2;s++){i.push([]);for(var u=0;u<c[s].length-2;u++)h.a.includes(r,c[s+1][u+1])?i[s][u]=1:i[s][u]=0}(i=i.reverse()).shift(),console.log("%cPathfinding Grid","font-weight: bold"),console.log("%c".concat(i.map(function(e,t){return"".concat(t,": ").concat(e.join(""))}).join("\n")),"font-family: monospace");var y=new I(i);console.log("(".concat(e.player.x,", ").concat(e.player.y,")"),"(".concat(n.x,", ").concat(n.y,")"));var m=w.search(y,y.grid[n.y][n.x],y.grid[e.player.y][e.player.x],{heuristic:w.heuristics.manhattan});if(console.log(m.map(function(e){return"(".concat(e.x,", ").concat(e.y,")")}).join(" ")),m.length>0){var d={x:m[0].y,y:m[0].x},p={x:n.x,y:n.y};n.x=d.x,n.y=d.y,console.log(d),e.player.x===n.x&&e.player.y===n.y&&(t.hp-=1,n.x=p.x,n.y=p.y,t.hp<=0&&(t.gameOver=!0));var f=t.player.items.find(function(e){return t.player.x+e.x===n.x&&t.player.y+e.y===n.y});f&&(n.x=p.x,n.y=p.y,f.type!==o.ItemSword&&(t.currentRoom.enemies=h.a.without(t.currentRoom.enemies,n),t.currentRoom.tiredEnemies.push(n),t.player.items=h.a.without(t.player.items,f)))}},s=t.currentRoom.enemies[Symbol.iterator]();!(n=(l=s.next()).done);n=!0)c()}catch(x){a=!0,i=x}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}var u=!0,y=!1,m=void 0;try{for(var d,p=e.currentRoom.tiredEnemies[Symbol.iterator]();!(u=(d=p.next()).done);u=!0){var f=d.value;t.currentRoom.tiredEnemies=h.a.without(t.currentRoom.enemies,f),t.currentRoom.enemies.push(f)}}catch(x){y=!0,m=x}finally{try{u||null==p.return||p.return()}finally{if(y)throw m}}return console.log(t),t}(r)):(console.log("Wall?"),t)}function S(e,t){return Object(s.a)({},t,{x:t.x-e.x,y:t.y-e.y})}function T(e){for(var t=[],r=0;r<8;r++)for(var n=0;n<8;n++)t.push({x:n,y:r});t=h.a.shuffle(t);for(var a=h.a.random(3,8),i=[],l=0;l<a;l++){var s=t.shift();i.push(H(s))}for(var u=[],y=h.a.filter(i,function(e){return e.type===o.ItemSword}).length,m=0;m<y;m++){var d=t.shift();u.push(d)}for(var p=Object(c.a)(e),f=h.a.shuffle([{x:-1,y:1/0},{x:8,y:1/0},{x:1/0,y:-1},{x:1/0,y:8}]),v=h.a.random(1,3),x=0;x<v;x++)for(var w=f.shift(),I=h.a.sample([1,2,2,2,3,3,4]),b=h.a.random(0,7-I),E=0;E<I;E++){var g={x:w.x,y:w.y};g.x===1/0?g.x=b+E:g.y===1/0&&(g.y=b+E),p.push(g)}return{size:8,exits:p,items:i,enemies:u,tiredEnemies:[],walls:[]}}function H(e){var t=[[o.ItemSword,o.HeldItemSword],[o.ItemMoney,o.HeldItemMoney],[o.ItemNormal,o.HeldItemNormal],[o.ItemPush,o.HeldItemPush],[o.ItemBlock,o.HeldItemBlock]],r=h.a.sample(t);return Object(s.a)({},e,{type:r[0],heldType:r[1]})}var B=function(e){function t(){var e,r;Object(u.a)(this,t);for(var o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];return(r=Object(m.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(n)))).handleClick=function(){r.props.onClick(r.props.type)},r}return Object(p.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){return n.createElement("div",{className:this.props.selected?"selected":"","data-tiletype":this.props.type,key:this.props.type,dangerouslySetInnerHTML:{__html:this.props.type},onTouchStart:this.handleClick})}}]),t}(n.Component),C=r(21),D=function(e){function t(e){var r;return Object(u.a)(this,t),(r=Object(m.a)(this,Object(d.a)(t).call(this,e))).joystickTimerId=void 0,r.maybeTouch=!1,r.initialState=void 0,r.undoStack=[],r.perform=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.state,o=e(t);return h.a.isEqual(o,t)||r.undoStack.push(e),o.gameOver?(console.log(o,r.initialState),h.a.cloneDeep(r.initialState)):o},r.handleJoystickMove=function(e){r.joystickTimerId&&clearTimeout(r.joystickTimerId),console.log(e.target.direction.angle);var t={up:g,down:k,left:b,right:E}[e.target.direction.angle];if(t){r.joystickTimerId=setTimeout(function e(){r.setState(r.perform(t)),r.joystickTimerId=setTimeout(e,150)},300),r.setState(r.perform(t))}else console.log("COULD NOT FIND HANDLER",e)},r.handleJoystickEnd=function(e){r.joystickTimerId&&clearTimeout(r.joystickTimerId)},r.handleKeyDown=function(e){var t={ArrowUp:g,ArrowDown:k,ArrowLeft:b,ArrowRight:E,Space:j,Period:R};if("KeyU"!==e.code&&"KeyZ"!==e.code){var o=t[e.code];o?r.setState(r.perform(o)):console.log("COULD NOT FIND HANDLER",e)}else{var n=h.a.cloneDeep(r.initialState);r.undoStack.pop();var a=!0,i=!1,l=void 0;try{for(var c,s=r.undoStack[Symbol.iterator]();!(a=(c=s.next()).done);a=!0){n=(0,c.value)(n)}}catch(u){i=!0,l=u}finally{try{a||null==s.return||s.return()}finally{if(i)throw l}}r.setState(n)}},r.didTapDrop=function(){r.setState(r.perform(j))},r.handleTouchStart=function(e){r.maybeTouch=!0},r.handleTouchMove=function(e){r.maybeTouch=!1},r.handleTouchEnd=function(e){r.maybeTouch&&r.didTapDrop(),r.maybeTouch=!1},r.handleEditorButtonClick=function(e){r.setState({selectedEditorButton:e})},r.handleEditorBoardClick=function(e,t){var n=r.state.selectedEditorButton;if(n)if(n===o.Player)r.setState({selectedEditorButton:void 0,player:Object(s.a)({},r.state.player,{x:e,y:t})});else if(n===o.Enemy){var a=[].concat(Object(c.a)(r.state.currentRoom.enemies),[{x:e,y:t,type:n}]);r.setState({selectedEditorButton:void 0,currentRoom:Object(s.a)({},r.state.currentRoom,{enemies:a})})}else if(n===o.Door){var i=[].concat(Object(c.a)(r.state.currentRoom.exits),[{x:e,y:t}]);r.setState({selectedEditorButton:void 0,currentRoom:Object(s.a)({},r.state.currentRoom,{exits:i})})}else if(n===o.Wall){var l=[].concat(Object(c.a)(r.state.currentRoom.walls),[{x:e,y:t}]);r.setState({selectedEditorButton:void 0,currentRoom:Object(s.a)({},r.state.currentRoom,{walls:l})})}else{var u={x:e,y:t,type:n,heldType:function(e){return e===o.ItemBlock?o.HeldItemBlock:e===o.ItemNormal?o.HeldItemNormal:e===o.ItemMoney?o.HeldItemMoney:e===o.ItemSword?o.HeldItemSword:e===o.ItemPush?o.HeldItemPush:e}(n)},y=[].concat(Object(c.a)(r.state.currentRoom.items),[u]);r.setState({selectedEditorButton:void 0,currentRoom:Object(s.a)({},r.state.currentRoom,{items:y})})}},r.initialState={exited:!1,gameOver:!1,hp:3,maxHP:3,player:{x:2,y:2,items:[]},currentRoom:T([{x:-1,y:4}])},r.state=h.a.cloneDeep(r.initialState),r}return Object(p.a)(t,e),Object(y.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("touchstart",this.handleTouchStart),window.addEventListener("touchmove",this.handleTouchMove),window.addEventListener("touchend",this.handleTouchEnd),C.create({color:"#000",dataOnly:!0,fadeTime:0}).on("added",function(t,r){r.on("dir",e.handleJoystickMove),r.on("end",e.handleJoystickEnd)})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var e=this,t=function(e){var t=e.tiles.map(function(t,r){var o=t.map(function(t,o){return a.a.createElement("span",{"data-x":o-1,"data-y":e.size-r,dangerouslySetInnerHTML:{__html:t},onTouchStart:function(){return e.onClick(o-1,e.size-r)}})});return a.a.createElement("div",null,o)});return a.a.createElement("div",{id:"grid"},t)}({tiles:v(this.state),size:this.state.currentRoom.size,onClick:this.handleEditorBoardClick}),r=this.state.player.items.filter(function(e){return e.type===o.ItemMoney}).length,n=[o.Player,o.Enemy,o.ItemBlock,o.ItemMoney,o.ItemNormal,o.ItemSword,o.Wall,o.Door].map(function(t){return a.a.createElement(B,{type:t,onClick:e.handleEditorButtonClick,selected:e.state.selectedEditorButton===t})});return a.a.createElement("div",{className:"App"},a.a.createElement("div",{id:"score-and-hp"},"$",r," | ",this.state.hp,"/",this.state.maxHP),t,a.a.createElement("div",{id:"level-editor"},n))}}]),t}(a.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(a.a.createElement(D,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[12,1,2]]]);
//# sourceMappingURL=main.047ece56.chunk.js.map